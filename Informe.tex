%%%%%%%%%%%%%%%%%%%%%%%%%%%%% Define Article %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\documentclass{article}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%%%%%%%%%%%%%%% Using Packages %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\usepackage{geometry}
\usepackage{graphicx}
\usepackage{amssymb}
\usepackage{amsmath}
\usepackage{amsthm}
\usepackage{empheq}
\usepackage{mdframed}
\usepackage{booktabs}
\usepackage{lipsum}
\usepackage{graphicx}
\usepackage{color}
\usepackage{psfrag}
\usepackage{pgfplots}
\usepackage{bm}
\usepackage{fancyhdr}
\usepackage{fontspec}
\usepackage[spanish]{babel}
\usepackage{datetime}
\usepackage{enumitem}
\usepackage{hyperref}
\usepackage{float}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\setmainfont{calibri}[BoldFont = Calibri Bold]
\hypersetup{colorlinks=true, linkcolor=blue}

%%%%%%%%%%%%%%%%%%%%%%%%%% Page Setting %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\geometry{a4paper}
\geometry{top=1.9cm, bottom=3.67cm, left=1.9cm, right=1.32cm}
\pagestyle{fancy}
\fancyhf{}
\lhead{\textbf{UNCuyo ‚Äì Ing. Mecatr√≥nica}\\Mendoza - Argentina}
\chead{\textbf{311 ‚Äì AUTOM√ÅTICA Y M√ÅQUINAS EL√âCTRICAS}\\ 
\textbf{PROYECTO GLOBAL INTEGRADOR}}
\rhead{Mamani - Vignolo\\  \today}
\rfoot{P√°gina \thepage{} de \pageref{LastPage}}
\renewcommand{\footrulewidth}{0.4pt}
\renewcommand{\headrulewidth}{0.4pt}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{document}

\begin{titlepage}
    \centering
    \vspace*{3cm}
    \Huge\textbf{\textsc{Control de Accionamiento de CA con Motor Sincronico de Imanes Permanentes}}\\
    \vspace{1.5cm}
    \large{Subtitulo}\\
    \vspace{10cm}
    \large{Autors:}\\
    \large{\textbf{Alan Vignolo\\Brandon Mamani}}\\
    \vfill
    \the\year\\ % o puedes especificar una fecha espec√≠fica en lugar de \today
\end{titlepage}

\part*{Introducci√≥n}

\lipsum

\newpage
\part*{Desarrollo}

\section*{Modelado, An√°lisis y Simulaci√≥n din√°mica del SISTEMA F√çSICO a Lazo Abierto}
\subsection*{Modelo matem√°tico equivalente del subsistema mec√°nico completo}

Subsistema mec√°nico del motor de CA trif√°sica s√≠ncrono, con el rotor referido al estator - sistema inercial de referencia:
\begin{equation}
    \label{eq:1.1}
    J_{m}.\dot{\omega}_{m}(t) = T_{m}(t)-b_{m}.\omega_{m}(t)-T_{d}(t) \\
\end{equation}
\begin{equation}
    \label{eq:1.2}
    \dot{\theta}_{m} = \omega_{m}
\end{equation}

Subsistema de tren de transmisi√≥n:
\begin{equation}
    \label{eq:2.1}
    \omega_{l}(t) = \frac{1}{r}.\omega_{m}(t) \\
\end{equation}
\begin{equation}
    \label{eq:2.2}
    T_{q}(t) = r.T_{d}(t) \\
\end{equation}

Subsistema de la carga mec√°nica:
\begin{equation}
    \label{eq:3.1}
    J_{l}.\dot{\omega}_{l}(t) = T_{q}(t)-b_{l}.\omega_{l}(t)-T_{l}(t) \\
\end{equation}
\begin{equation}
    \label{eq:3.2}
    \dot{\theta}_{l} = \omega_{l}\\
\end{equation}

Sistema mec√°nico equivalente completo:
\begin{equation}
    \label{eq:4.1}
    (J_{m}+\frac{J_l}{r^2}).\dot{\omega}_{m}(t) = T_{m}(t)-(b_{m}+\frac{b_{l}}{r^2}).\omega_{m}(t)-\frac{T_{l}(t)}{r} \\
\end{equation}

\begin{equation}
    J_{eq}.\dot{\omega}_{m}(t) = T_{m}(t)-b_{eq}.\omega_{m}(t)-\frac{T_{l}(t)}{r} \\
\end{equation}

\begin{equation}
    \dot{\omega}_{m}(t) = \frac{1}{J_{eq}}.[T_{m}(t) - b_{eq}.\omega_{m}(t) - \frac{T_{l}(t)}{r}]\\
\end{equation}

\begin{equation}
\begin{cases}
    \begin{bmatrix}
        \dot{\theta}_{m}(t)\\
        \dot{\omega}_{m}(t)\\
    \end{bmatrix}
    =
    \begin{bmatrix}
        0 & 1\\
        0 & -\frac{b_{eq}}{J_{eq}}\\
    \end{bmatrix}.
    \begin{bmatrix}
        \theta_{m}(t)\\
        \omega_{m}(t)\\
    \end{bmatrix}
    +
    \begin{bmatrix}
        0 & 0\\
        \frac{1}{J_{eq}} & -\frac{1}{J_{eq}r}\\
    \end{bmatrix}.
    \begin{bmatrix}
        T_{m}(t)\\
        T_{l}(t)\\
    \end{bmatrix}\\
    y(t) = 
    \begin{bmatrix} 1 & 0\\ \end{bmatrix} .
    \begin{bmatrix} \theta_{m}(t)\\ \omega_{m}(t)\\ \end{bmatrix}
\end{cases}
\end{equation}

Con este modelo matem√°tico equivalente referido al eje del motor tiene como 
ventaja que no presenta backlash, ademas no hay que considerar el efecto de 
la elasticidad torsional de la transmisi√≥n.

% ------------------  5.1.2  --------------------- %

\subsection*{Modelo din√°mico del sistema f√≠sico completo}

% ------------------ 5.1.2.a --------------------- %

\subsubsection*{Modelo global no lineal (NL)}

En el modelo global no lineal consideramos todos los sistemas involucrados 
como el sistema mec√°nico, previamente desarrollado, 
y los subsistemas electromagn√©tico y t√©rmico.

En primer lugar, nos enfocaremos en el subsistema electromagn√©tico, teniendo en cuenta que 
se utiliza un motor s√≠ncrono de corriente alterna (CA) trif√°sico con excitaci√≥n de imanes 
permanentes. El estator esta conectado en estrella con bornes abc accesible y neutro no accesible.
Consideramos que la carga de cada fase sera equivalente de forma que la conexi√≥n estrella este equilibrada.

Ecuaciones de tensi√≥n en coordenadas abc:

\begin{equation}
    \begin{aligned}
        v_{as}(t) &= R_{s}(t).i_{as}(t) + \frac{d\lambda_{as}}{dt}\\
        v_{bs}(t) &= R_{s}(t).i_{bs}(t) + \frac{d\lambda_{bs}}{dt}\\
        v_{cs}(t) &= R_{s}(t).i_{cs}(t) + \frac{d\lambda_{cs}}{dt}\\
    \end{aligned}
\end{equation}

Mediante la transformaci√≥n de Park, que consiste en premultiplicar por la matriz de Park y teniendo en 
cuenta las coordenadas $qd0$ fijas al rotor:

\begin{equation}
    \begin{aligned}
        \dot{\theta}_r = \omega_r(t) \Leftrightarrow  \theta_r = \int_0^t \omega_r(\xi).d\xi + \theta_r(0)\\
        \theta_r(t) = P_p.theta_m(t) \therefore \omega_r(t) = P_p.\omega_m(t)\\
    \end{aligned}
\end{equation}

Se obtiene:

\begin{equation}\label{eq.tensiones_qd0}
    \begin{aligned}
        v_{qs}(t) &= R_{s}(t).i_{qs}(t) + L_{q}.\dot{i}_{qs}^r(t) + [\lambda_{m}^{\prime r} + L_{d}.i_{ds}(t)].\omega_{r}(t)\\
        v_{ds}(t) &= R_{s}(t).i_{ds}(t) + L_{d}.\dot{i}_{ds}^r(t)  - L_{q}.i_{qs}(t).\omega_{r}(t)\\
        v_{0s}(t) &= R_{s}(t).i_{0s}(t) + L_{ls}.\dot{i}_{0s}^r(t)
    \end{aligned}
\end{equation}

Reordenando:

\begin{equation}\label{eq:mi_ecuacion}
    \begin{cases}
        \dot{i}_{qs}(t) = \frac{1}{L_{q}}.[v_{qs}^r(t) - R_{s}(t).i_{qs}^r(t) - P_{p}.\omega_{m}(t).[L_{d}.i_{ds}^r(t) + \lambda_{m}^{\prime r}]]  \\
        \dot{i}_{ds}(t) = \frac{1}{L_{d}}.[v_{ds}^r(t) - R_{s}(t).i_{ds}^r(t) + P_{p}.\omega_{m}(t).L_{q}.i_{qs}^r(t)]  \\
        \dot{i}_{0s}(t) = \frac{1}{L_{ls}}.[v_{0s}^r(t) - R_{s}(t).i_{0s}^r(t)]
    \end{cases}
\end{equation}

El torque electromagn√©tico queda definido por:

\begin{equation}\label{eq.torque_electromagnetico}
    T_{m}(t) = \frac{3}{2}.P_{p}.[\lambda_{m}^{\prime r}+i_{ds}^r(t).(L_{d}-L_{q})].i_{qs}^r(t)
\end{equation}

Para el subsistema t√©rmico solo se consideran las p√©rdidas el√©ctricas resistivas causadas por el 
efecto Joule (calor), despreciando las p√©rdidas magn√©ticas en el n√∫cleo y las transferencia de 
calor por conducci√≥n y convecci√≥n natural. La potencia de p√©rdidas cal√≥ricas est√° dada por:

\begin{equation}
    P_{s_{perd}}(t) =  \frac{3}{2}.R_{s}(t).[i_{qs}^r(t)^2+i_{ds}^r(t)^2+2.i_{0s}(t)]\\
\end{equation}

El balance t√©rmico en el estator:

\begin{equation}
    P_{s_{perd}}(t) = C_{ts}.\dot{T}_{s}(t) + \frac{T_{s}(t)-T_{amb}(t)}{R_{ts-amb}}
\end{equation}

Reemplazando estas dos ecuaciones y juntando los dem√°s subsistemas obtenemos el modelo global:

\begin{equation}\label{eq.modelo_global}
    \begin{cases}
        \dot{\theta}_{m}(t) = \omega_{m}(t)\\
        \dot{\omega}_{m}(t) = \frac{1}{J_{eq}}.[\frac{3}{2}.P_{p}.[\lambda_{m}^{\prime r}+i_{ds}^r(t).(L_{d}-L_{q})].i_{qs}^r(t) - b_{eq}.\omega_{m}(t) - \frac{T_{l}(t)}{r}]\\
        \dot{i}_{qs}(t) = \frac{1}{L_{q}}.[v_{qs}^r(t) - R_{s}(t).i_{qs}^r(t) - P_{p}.\omega_{m}(t).[L_{d}.i_{ds}^r(t) + \lambda_{m}^{\prime r}]]  \\
        \dot{i}_{ds}(t) = \frac{1}{L_{d}}.[v_{ds}^r(t) - R_{s}(t).i_{ds}^r(t) + P_{p}.\omega_{m}(t).L_{q}.i_{qs}^r(t)]  \\
        \dot{i}_{0s}(t) = \frac{1}{L_{ls}}.[v_{0s}^r(t) - R_{s}(t).i_{0s}^r(t)]\\
        \dot{T}_{s}(t) = \frac{1}{C_{ts}}.[\frac{3}{2}.R_{s}(t).[{i_{qs}^r(t)}^2+{i_{ds}^r(t)}^2 + 2.i_{0s}(t)^2] - \frac{T_{s}(t)-T_{amb}(t)}{R_{ts-amb}}]\\
    \end{cases}
\end{equation}

% IMAGEN DEL DIAGRAMA GLOBAL NL %

%-------------------------- 5.1.2.B ------------------------------------------%

\subsubsection*{Modelo global linealizado con par√°metros variables (LPV)}

Para el caso general en el que ${i}_{ds}(t) \neq 0$. Se puede representar al sistema no lineal de forma gen√©rica
como: 

\begin{equation}
    \begin{cases}
        \dot{x}(t) = f(x(t),u(t));  \quad   x(t_{0}) = x_{0}\\
        y(t) = C.x(t)\\
    \end{cases}
\end{equation}

Donde $f$ es una funci√≥n que representa la din√°mica del sistema en t√©rminos de las variable 
de estado $x(t)$ y las estradas $u(t)$.  

Dados los punto de equilibrio din√°mico donde las derivadas de las variables de estado son nulas:

\begin{equation}
    \dot{x}(t) = f(x(t),u(t)) = 0
\end{equation}

Todos los pares de puntos $[X_0,U_0]$ que satisfacen la ecuaci√≥n anterior definen el conjunto de
puntos de operaci√≥n. Estos puntos los consideraremos cuasi-estacionarios. 

Alrededor de estos puntos consideraremos peque√±as variaciones infinitesimales:

\begin{equation}
    \begin{cases}
        x(t) = X_{0}(t) + \Delta x(t)\\
        u(t) = U_{0}(t) + \Delta u(t)\\
        y(t) = Y_{0}(t) + \Delta y(t)\\
    \end{cases}
\end{equation}

De forma que el el sistema gen√©rico global NL queda representado por:

\begin{equation}
    \begin{cases}
        \dot{x}(t) = \dot{X}_{0}(t) + \Delta\dot{x}(t) = f(X_{0}(t) + \Delta x(t), U_{0}(t) + \Delta u(t))\\
        X_{0}(0) + \Delta x(0) = x_{0} \quad\quad\quad \rightarrow \quad X_{0} = x_{0}, \Delta x(0) = 0 \\
        Y_{0}(t) + \Delta y(t) = C(X_{0}(t) + \Delta x(t)) \quad\rightarrow\quad Y_{0}(t) = C X_{0}(t); \Delta y(t) = C \Delta x(t)\\
    \end{cases}
\end{equation}

Aproximaci√≥n mediante la serie de Taylor truncada al primer orden y despreciando los terminos
de orden superior:

\begin{equation}
    f(X_{0}(t) + \Delta x(t), U_{0}(t) + \Delta u (t)) \approx f(X_{0}(t), U_{0}(t)) + \frac{\partial f}{\partial x}\mid_{0}\Delta x(t) + \frac{\partial f}{\partial u}\mid_{0}\Delta u(t)
\end{equation}

Al aplicar esto a nuestro modelo NL el sistema se divide en dos partes, una NL cuasi-estacionaria y otra 
lineal din√°mica que representa las peque√±as variaciones alrededor de puntos de operaci√≥n.

Modelo NL cuasi-estacionario:

\begin{equation}
    \dot{X}_{0}(t) = f(X_{0}(t), U_{0}(t)) \quad \approx 0 \;/\; \text{cte}; \quad X_{0}(0) = x_{0}
\end{equation}

Modelo lineal din√°mico:

\begin{equation}
    \Delta\dot{x}(t) = \frac{\partial f}{\partial x}\mid_{0}\Delta x(t) + \frac{\partial f}{\partial u}\mid_{0}\Delta u(t); \quad \Delta x(0) = 0\\
\end{equation}

Al aplicar este concepto a las ecuaciones del
\hyperref[eq.modelo_global]{Modelo global NL (\ref*{eq.modelo_global})}
obtenemos:

\begin{itemize}

    \item Espacio de operaci√≥n global NL (cuasi - estacionario)

    \begin{equation}
        \begin{cases}
            \dot{\theta}_{m0} = \omega_{m0} = cte\\
            \dot{\omega}_{m0} = \frac{1}{J_{eq}}.[\frac{3}{2}.P_{p}.[\lambda_{m}^{\prime r} + i_{ds0}^r.(L_{d}-L_{q})].i_{qs0}^r - b_{eq}.\omega_{m0} - \frac{T_{l0}}{r}] = 0\\
            \dot{i}_{qs0} = \frac{1}{L_{q}.}[v_{qs0}^r - R_{s}(t).i_{qs0}^r - P_{p}.\omega_{m0}.[L_{d}.i_{ds0}^r + \lambda_{m}^{\prime r}]] = 0\\
            \dot{i}_{ds0} = \frac{1}{L_{d}}.[v_{ds0}^r - R_{s}(t).i_{ds0}^r + P_{p}.\omega_{m0}.L_{q}.i_{qs0}^r] = 0 \\
            \dot{i}_{0s0} = \frac{1}{L_{ls}}.[v_{0s0}- R_{s}(t).i_{0s0}] = 0\\
            \dot{T}_{s0} = \frac{1}{C_{ts}}.[\frac{3}{2}.R_{s}(t).[{i_{qs0}^r}^2 + {i_{ds0}^r}^2 + 2.i_{0s0}^2]-\frac{T_{s0}-T_{amb0}}{R_{ts-amb}}] = 0\\
        \end{cases}
    \end{equation}

    \item Modelo din√°mico LPV
    \begin{equation}
        \begin{cases}
            \Delta\dot{\theta}_{m}(t) = \Delta\omega_{m}(t)\\
            \Delta\dot{\omega}_{m}(t) = \frac{1}{J_{eq}}.[\frac{3}{2}.P_{p}.\{[\lambda_{m}^{\prime r} + i_{ds0}^r.(L_{d}-L_{q})].\Delta i_{qs}^r(t) + \Delta i_{ds}^r(t).(L_{d}-L_{q})].i_{qs0}^r\}- b_{eq}.\Delta\omega_{m}(t) - \frac{\Delta T_{l}(t)}{r}]\\
            \Delta\dot{i}_{qs}(t) = \frac{1}{L_{q}}.[\Delta v_{qs}^r(t) - R_{s}(t).\Delta i_{qs}^r(t) - P_{p}.\Delta\omega_{m}(t).[L_{d}.i_{ds0}^r + \lambda_{m}^{\prime r}] - P_{p}.\omega_{m0}.L_{d}.\Delta i_{ds}^r(t)] \\
            \Delta\dot{i}_{ds}(t) = \frac{1}{L_{d}}.\Delta [v_{ds}^r(t) - R_{s}(t).\Delta i_{ds}^r(t) + P_{p}.\Delta\omega_{m}(t).L_{q}.i_{qs0}^r + P_{p}.\omega_{m0}.L_{q}.\Delta i_{qs}^r(t)]  \\
            \Delta\dot{i}_{0s}(t) = \frac{1}{L_{ls}}.[\Delta v_{0s}(t) - R_{s}(t).\Delta i_{0s}(t)] \\
            \Delta\dot{T}_{s}(t) = \frac{1}{C_{ts}}.\{\frac{3}{2}.R_{s}(t).[{2.i_{qs}^r.\Delta i_{ds}^r(t)} + 2.i_{as}^r.\Delta i_{as}^r(t) + 4.i_{0s}.\Delta i_{0s}(t)]-\frac{\Delta T_{s}(t)-\Delta T_{amb}(t)}{R_{ts-amb}}\}\\
        \end{cases}
    \end{equation}

    En forma matricial:

\begin{equation*}
\begin{gathered}
    \begin{bmatrix}
        \Delta\dot{\theta}_{m}(t)\\
        \Delta\dot{\omega}_{m}(t)\\
        \Delta\dot{i}_{qs}(t)\\
        \Delta\dot{i}_{ds}(t)\\
        \Delta\dot{i}_{0s}(t)\\
        \Delta\dot{T}_{s}(t)\\
    \end{bmatrix} =
    \begin{bmatrix}
        0 & 1 & 0 & 0 & 0  & 0 \\
        0 & -b_{eq} & \frac{3}{2}.P_{p}.\frac{[\lambda_{m}^{\prime r} + i_{qs0}^r(t).(L_{d}-L_{q})]}{J_{eq}} & \frac{3}{2}.\frac{P_{p}.(L_{d}-L_{q}).i_{qs}^r}{J_{eq}} & 0 & 0\\
        0 & -\frac{P_{p}.(\lambda_{m}^{\prime r} + L_{d}.i_{ds0}^r)}{L_{q}} & -\frac{R_{s}(t)}{L_{q}} & -\frac{L_{d}.P_{p}.\omega_{m0}}{L_{q}} & 0 & 0\\
        0 & \frac{P_{p}.i_{qs0}^r .L_{q}}{L_{d}} & \frac{L_{q}.P_{p}.\omega_{m0}}{L_{d}} & -\frac{R_{s}(t)}{L_{d}} & 0 & 0\\
        0 & 0 & 0 & 0 & -\frac{R_{s}(t)}{L_{ls}} & 0\\
        0 & 0 & \frac{3.R_{s}(t)}{C_{ts}}.i_{qs0}^r & \frac{3.R_{s}(t)}{C_{ts}}.i_{ds0}^r & \frac{6.R_{s}(t)}{C_{ts}}.i_{0s0} & -\frac{1}{C_{ts}.R_{ts-amb}}\\
    \end{bmatrix}
    \begin{bmatrix}
        \Delta{\theta}_{m}(t)\\
        \Delta{\omega}_{m}(t)\\
        \Delta{i}_{qs}(t)\\
        \Delta{i}_{ds}(t)\\
        \Delta{i}_{0s}(t)\\
        \Delta{T}_{s}(t)\\
    \end{bmatrix}\\  + 
    \begin{bmatrix}
        0 & 0 & 0 & 0 & 0\\
        -\frac{1}{rJ_{eq}} & 0 & 0 & 0 & 0\\
        0 & \frac{1}{L_{q}} & 0 & 0 & 0\\
        0 & 0 & \frac{1}{L_{d}} & 0 & 0\\
        0 & 0 & 0 & \frac{1}{L_{ls}} & 0\\
        0 & 0 & 0 & 0 & \frac{1}{C_{ts}R_{ts-amb}}\\
    \end{bmatrix}
    \begin{bmatrix}
        \Delta{T}_{l}(t)\\
        \Delta{V}_{qs}(t)\\
        \Delta{V}_{ds}(t)\\
        \Delta{V}_{0s}(t)\\
        \Delta T_{amb}(t)\\
    \end{bmatrix} 
\end{gathered}
\end{equation*}

\end{itemize}

%-------------------- 5.1.2.c --------------------------%

\subsubsection*{Linealizaci√≥n por Realimentaci√≥n NL}

Se busca un modelo simplificado lineal invariante LTI equivalente al modelo NL del sistema, 
para ello se propone un controlador de realimentaci√≥n de estados que permita linealizar el 
modelo global NL obtenido anteriormente, por lo que se propone:

\begin{itemize}
    \item Aplicar la estrategia de ‚ÄúControl Vectorial con campo orientado‚Äù la cual 
    consiste en desacoplar los canales de flujo magn√©tico y torque, lo cual provoca
    un forzamiento de $i_{ds}=0$ 
    \item Dada la conexi√≥n estrella con neutro flotante $i_{0s} = 0 \to \dot{i}_0s = 0 \to v_{0s} = 0$
    \item Desacoplar el subsistema t√©rmico, ya que se considera que hay variaciones despreciables 
    de $R_s$ en el rango de temperaturas de trabajo.
\end{itemize}

\begin{enumerate}[label=\roman*.]
    \item \textbf{Ecuaciones vectoriales/matriciales LTI de estado y de salida.} 
    
    Aplicadas las condiciones mencionadas nos queda un sistema LTI similar al de un maquina 
    de corriente continua con escobillas. El estado inicial sera nulo.

    \begin{equation}
        \begin{cases}
            \dot{\theta}_{m}(t) = \omega_{m}(t)\\
            \dot{\omega}_{m}(t) = \frac{1}{J_{eq}}[\frac{3}{2}P_{p}\lambda_{m}^{\prime r}i_{qs}^r(t) - b_{eq}\omega_{m}(t) - \frac{T_{l}(t)}{r}]\\
            \dot{i}_{qs}(t) = \frac{1}{L_{q}}[v_{qs}^r(t) - R_{s}i_{qs}^r(t) - P_{p}\omega_{m}(t)\lambda_{m}^{\prime r}]  \\
        \end{cases}
    \end{equation}

    De forma matricial:

    \begin{equation}
        \begin{cases}
            \begin{bmatrix}
                \dot{\theta}_{m}(t)\\
                \dot{\omega}_{m}(t)\\
                \dot{i}_{qs}(t)\\
            \end{bmatrix} =
            \begin{bmatrix}
                0 & 1 & 0\\
                0 & -\frac{b_{eq}}{J_{eq}} & \frac{3}{2}\frac{P_{p}\lambda_{m}^{\prime r}}{J_{eq}}\\
                0 & -\frac{P_{p}\lambda_{m}^{\prime r}}{L_{q}} & -\frac{R_{s}}{L_{q}}\\
            \end{bmatrix}
            \begin{bmatrix}
                {\theta}_{m}(t)\\
                {\omega}_{m}(t)\\
                {i}_{qs}(t)\\
            \end{bmatrix} +
            \begin{bmatrix}
                0\\
                0\\
                \frac{1}{L_{eq}}\\
            \end{bmatrix} v_{qs}^r(t) +
            \begin{bmatrix}
                0\\
                -\frac{1}{rJ_{eq}}\\
            \end{bmatrix} T_{l}(t)\\
            y(t) =
            \begin{bmatrix}
                1 & 0 & 0\\
            \end{bmatrix}
            \begin{bmatrix}
                {\theta}_{m}(t)\\
                {\omega}_{m}(t)\\
                {i}_{qs}(t)\\
            \end{bmatrix}
        \end{cases}
    \end{equation}

    Para linealizar el subsistema t√©rmico podemos suponer que $R_s$ sera constante debido a su poca variaci√≥n
    de forma que:

    \begin{equation}
        \dot{T}_{s}(t) = \frac{1}{C_{ts}}.[\frac{3}{2}.R_{s}.{i_{qs}^r(t)}^2 - \frac{T_{s}(t)-T_{amb}(t)}{R_{ts-amb}}]\\
    \end{equation}
        
    \item \textbf{Diagrama de bloques de estado (forma desagregada o escalar)}
    
    % IMAGEN DEL MODELO LTI $
    
    \item \textbf{Restricci√≥n o Ley de Control m√≠nima}

    Para poder cumplir con la restricci√≥n de $i_{ds} = 0$ se tiene que cumplir la condici√≥n dada por la
    \hyperref[eq.tensiones_qd0]{ecuaci√≥n (\ref*{eq.tensiones_qd0})}. De manera que:

    \begin{equation}
        v_{ds}^r(t) = -L_{q}.i{qs}^r(t).\omega_{m}(t).P_{p}
    \end{equation}

    Dado que se trata de una variable virtual no podemos controlarla directamente, por lo que buscaremos
    expresarla en termino de las coordenadas "abc", por lo que aplicamos la transformada inversa de Park.
    Resolviendo llegamos a:

    \begin{equation}
        \begin{cases}
            v_{as}(t) = cos(\theta_{r}(t)).v_{qs}^r(t) + sin(\theta_{r}(t)).v_{ds}^r(t) + v_{0s}^r(t)\\
            v_{bs}(t) = cos(\theta_{r}(t) - \frac{2\pi}{3}).v_{qs}^r(t) + sin(\theta_{r}(t) - \frac{2\pi}{3}).v_{ds}^r(t) + v_{0s}^r(t)\\
            v_{cs}(t) = cos(\theta_{r}(t) + \frac{2\pi}{3}).v_{qs}^r(t) + sin(\theta_{r}(t) + \frac{2\pi}{3}).v_{ds}^r(t) + v_{0s}^r(t)\\
        \end{cases}
    \end{equation}

    Dado que los valores de $v_{ds}(t)$ y $v_{0s}(t)$ son conocidos los sustituimos: 

    \begin{equation}
        \begin{cases}
            v_{as}(t) = cos(\theta_{r}(t))v_{qs}^r(t) - sin(\theta_{r}(t))L_{q}i{qs}^r(t)\omega_{m}(t)P_{p}\\
            v_{bs}(t) = cos(\theta_{r}(t) - \frac{2\pi}{3})v_{qs}^r(t) - sin(\theta_{r}(t) - \frac{2\pi}{3})L_{q}i{qs}^r(t)\omega_{m}(t)P_{p}\\
            v_{cs}(t) = cos(\theta_{r}(t) + \frac{2\pi}{3})v_{qs}^r(t) + sin(\theta_{r}(t) - \frac{2\pi}{3})L_{q}i{qs}^r(t)\omega_{m}(t)P_{p}\\
        \end{cases}
    \end{equation}

    Esta sra la realimentaci√≥n necesaria para desacoplar los canales de flujo magnetico y torque.

    \item \textbf{Implementacion sobre el modelo global NL}

    % IMAGEN DE LA REALIMENTACION %

    \item \textbf{Din√°mica Residual}
    
    Al aplicar la ley de control minimo suposimos que $i_{ds} = 0$, sin embargo, esto no es del todo cierto
    por lo que se debe tener en cuenta la dinamica residual de la corriente $i_{ds}$, la cual se puede
    modelar con la siguiente EDO:

    \begin{equation*}
        \begin{aligned}
        \frac{di_{ds}^r(t)}{dt} = \frac{1}{L_{d}}[-R_{s}(t)i_{ds}^r(t)] \\
        \frac{di_{ds}^r(t)}{dt} + \frac{R_{s}(t)}{L_{d}}i_{ds}^r(t) = 0 
        \end{aligned}
    \end{equation*} 

    La cual tiene como soluci√≥n:

    \begin{equation}
        i_{ds}^r(t) = i_{ds}^r(0)e^{-\frac{R_{s}(t)}{L_{d}}t}
    \end{equation}

    Esta solucion nos indica que el efecto de la dinamica residual es despreciable en el tiempo, ya que actua como
    un sistema subamortiguado de primer orden.

    En regimen natural producira un comportamiento no lineal sobre el sistema esta dado por:

    \begin{equation}\label{eq.dinamica_residual}
        v_{qs}(t) = L_{q}\frac{di_{qs}^r(t)}{dt} + R_{s}i_{qs}^r(t) + P_{p}\omega_{m}(t)\lambda_{m}^{\prime r} + \mathbf{L_{d}i_{ds}^r(t)P_{p}\omega_{m}(t)}
    \end{equation}

    Incorporando la dianmica residual al modelo LTI:

    \begin{equation}
        \begin{cases}
            \dot{\theta}_{m}(t) = \omega_{m}(t)\\
            \dot{\omega}_{m}(t) = -\frac{1}{J_{eq}}[\frac{3}{2}P_{p}\lambda_{m}^{\prime r} i_{qs}^r(t) - b_{eq}\omega_{m}(t)-\frac{T_{l}(t)}{r}]\\
            \dot{i}_{qs}^r(t) = \frac{1}{L_{q}}[v_{qs}^r(t) - R_{s}i_{qs}^r(t) - P_{p}\omega_{m}(t)\lambda_{m}^{\prime r}]\\
            \dot{T}_{s}(t) = \frac{1}{C_[ts]}\{\frac{3}{2}R_{s}(t)[{i_{qs}^r}^2(t) + {i_{ds}^r}^2(t)] - \frac{1}{R_{ts-amb}}[T_{s}(t) - T_{amb}(t)]\}\\
            \dot{i}_{ds}^r(t) = -\frac{R_{s}(t)}{L_{d}}i_{ds}^r(t) \\
        \end{cases}    
    \end{equation}

    % IMAGEN DE LA DINAMICA RESIDUAL %

    \item \textbf{Restricci√≥n Ley de Control complementaria minima en el eje q}
    
    Para anular el efecto NL del acoplamineto de la dinamica residual podemos a partir de la
    \hyperref[eq.dinamica_residual]{ecuaci√≥n (\ref*{eq.dinamica_residual})}
    plantear la siguiente restricci√≥n sobre el eje q:

    \begin{equation}
        v_{qs}(t) = L_{q}\frac{di_{qs}^r(t)}{dt} + R_{s}i_{qs}^r(t) + P_{p}\omega_{m}(t)\lambda_{m}^{\prime r} + L_{d}i_{ds}^r(t)P_{p}\omega_{m}(t) - \mathbf{L_{d}i_{ds}^r(t)P_{p}\omega_{m}(t)}
    \end{equation}

    % IMAGEN DEL MODELO %

\end{enumerate}

%-------------------- 5.1.2.d --------------------------%

\subsubsection*{Comparaci√≥n modelo din√°mico LTI equivalente aumentado vs modelo din√°mico global LPV}

El modelo din√°mico global LPV para el caso general donde $i_{ds}^r \neq 0$
es una mejor representaci√≥n del sistema real al tener mejor representadas sus 
no linealidades.
En cambio el modelo LTI, donde $i_{ds}^r = 0$, tiene la ventaja de un modelo 
con un mayor grado de simplicidad. Sin embargo, esta simplificaci√≥n  causa que 
el espacio de puntos de operaci√≥n se reduzca.
Analizaremos el comportamiento del sistema frente a cambios de $i_{ds}^r$, 
considerando el estado estacionario. 

\begin{itemize}
    
    \item Respecto al par electromagn√©tico:

    \begin{equation}
        T_{m}(t) = \frac{3}{2}P_{p}[\lambda_{m}^{\prime r} + (L_{d}-L_{q})i_{ds}^r(t)]
    \end{equation}

    Para motores de polos salientes $L_{d} > L_{q}$, entonces cuando $i_{ds}^r(t)$
    toma valores positivos el campo magn√©tico se refuerza lo que aumenta el torque del
    motor. Si la corriente directa toma valores negativos el campo magn√©tico se debilita 
    y disminuye el torque del motor. 

    \item Respecto al subsistema el√©ctrico:

    % Voltaje con min√∫sculas
    \begin{equation}
        \dot{i}_{ds}^r = \frac{1}{L_{d}}[v_{ds}(t) - R_{s}(t)i_{ds}^r(t) + L_{q}i_{qs}^r(t)P_{p}\omega_[m](t)] = 0
    \end{equation}
    \begin{equation}
        \omega_{m}(t) = \frac{-v_{ds}(t) + R_{s}(t)i_{ds}^r(t)}{L_{q}}
    \end{equation}

    En este caso, la velocidad del motor disminuye cuando la corriente $i_{ds}^r$ 
    aumenta. Por lo que podemos concluir que el torque reaccionara inversamente 
    a la velocidad.

\end{itemize}

En el caso que $i_{ds}^r(t) = 0$, el flujo concatenado solamente esta afectado por 
los imanes permanentes.

%-------------------- 5.1.2.e --------------------------%

\subsubsection*{Funciones de transferencia para el modelo LTI}

Las funciones de transferencia nos permiten relacionar las salidas con las entradas del sistema.
Como nuestro sistema dispone de dos entradas obtendremos dos funciones de transferencia.

Para comenzar, es necesario aplicar la transformada de Laplace a las ecuaciones del modelo LTI:

\begin{equation}
        L[f{t}] = F(s)
\end{equation}

La transformada de Laplace posee la siguiente propiedad

\begin{equation}
        L[\dot{f}(t)] = s F(s) - f(0)
\end{equation}

Al aplicar la transformada y recordando que las condiciones iniciales son nulas, el 
modelo queda

\begin{equation}
    \begin{cases}
        s\Theta_{m}(s) = \Omega_{m}(s)\\
        s\Omega_{m}(s) = \frac{1}{J_{eq}}[\frac{3}{2} P_{p} \lambda_{m}^{\prime r} I_{qs}^r(s) - b_{eq}\Omega(s) - \frac{T_{l}(s)}{r}]\\
        s I_{qs}^r(s) = \frac{1}{L_{q}}[v_{qs}^r(s) - R_{s}I_{qs}^r(s) - P_{p}\Omega_{m}(s)\lambda_{m}^{\prime r}]\\
    \end{cases}
\end{equation}

Para obtener las funciones de transferencia del modelo, se despeja $I_{qs}^r(s)$

\begin{equation}
    I_{qs}^r(s) = \frac{v_{qs}^r(s) - P_{p}\Omega_{m}(s)\lambda_{m}^{\prime r}}{s L_{q} + R_{s}}
\end{equation}
 
Remplazando en las ecuaciones de estado 

\begin{equation}
    \Theta_{m}(s) = \frac{\frac{3}{2}.P_{p}.\lambda_{m}^{\prime r}.v_{qs}(s) - \frac{1}{r}.(s.L_{q}+R_{s}).T_{l}(s)}{s^3.J_{eq}.L_{q} + s^2.(b_{eq}.L_{q} +  R_{s}.J_{eq}) + s.[b_{eq}.R_{s}+\frac{3}{2}.(P_{p}.\lambda_{m}^{\prime r})^2]}
\end{equation}

De esta expresi√≥n se obtienen las funciones de transferencia respecto de las entradas tension $v_{qs}(s)$ y torque $T_{l}(s)$

\begin{equation}\label{eq.trasnferencia_1}
    G_{1}(s) = \frac{\Theta_{m}(s)}{v_{qs}(s)} = \frac{\frac{3}{2}.P_{p}.\lambda_{m}^{\prime r}}{s^3.J_{eq}.L_{q} + s^2.(b_{eq}.L_{q} +  R_{s}.J_{eq}) + s.[b_{eq}.R_{s}+\frac{3}{2}.(P_{p}.\lambda_{m}^{\prime r})^2]}
\end{equation}

\begin{equation}\label{eq.transferencia_2}
    G_{2}(s) = \frac{\Theta_{m}(s)}{T_{l}(s)} = \frac{- \frac{1}{r}.(s.L_{q}+R_{s})}{s^3.J_{eq}.L_{q} + s^2.(b_{eq}.L_{q} +  R_{s}.J_{eq}) + s.[b_{eq}.R_{s}+\frac{3}{2}.(P_{p}.\lambda_{m}^{\prime r})^2]}
\end{equation}

%-------------------- 5.1.3 --------------------------%

\subsection*{An√°lisis de Estabilidad}

Para realizar un an√°lisis de estabilidad debemos primero determinar polos (ceros del denominador) del 
sistema a partir de la funci√≥n de transferencia obtenida anteriormente:

\begin{equation}
    s^3.J_{eq}.L_{q} + s^2.(b_{eq}.L_{q} +  R_{s}.J_{eq}) + s.[b_{eq}.R_{s}+\frac{3}{2}.(P_{p}.\lambda_{m}^{\prime r})^2] = 0
\end{equation}

Utilizando Matlab para poder resolver este polinomio obtenemos que los valores que la satisfacen son:

\begin{align*}
    s_{1} &= 0\\
    s_{2} &= \frac{-(L_q.b_{eq} + R_s.J_{eq}) + sqrt{(L_q.b_{eq} + R_s.J_{eq})^2 - 4.J_{eq}.L_q.(R_s.b_eq + \frac{3}{2}.P_p^2.\lambda_{m}^{\prime r})^2}}{2.J_{eq}.L_q}\\
    s_{3} &= \frac{-(L_q.b_{eq} + R_s.J_{eq}) - sqrt{(L_q.b_{eq} + R_s.J_{eq})^2 - 4.J_{eq}.L_q.(R_s.b_eq + \frac{3}{2}.P_p^2.\lambda_{m}^{\prime r})^2}}{2.J_{eq}.L_q}
\end{align*}

Reemplazando los valores de los par√°metros y teniendo en cuenta que Rs puede estar entre 
$1,02\, \Omega$ y $1,32\, \Omega$ de manera lineal encontramos los polos se encuentran en 
funci√≥n de este valor dado que las dem√°s variables son datos conocidos.

Para determinar los ceros evaluamos  el numerador de la funci√≥n de transferencia
\hyperref[eq.transferencia_2]{funci√≥n de transferencia (\ref*{eq.transferencia_2})}
. De aqu√≠ notamos que solo $T_l(t)$ introduce ceros al sistema, obteniendo, al igual que en el caso 
de los polos, funciones dependientes de $Rs$.

\begin{align*}
    s.L_q+ R_s = 0 &\to& s = - \frac{R_s}{L_q} = - \frac{R_s}{5,9.10^3}\\ 
\end{align*}

Podemos hacer un gr√°fico en el plano imaginario sobre como var√≠an estos valores seg√∫n el valor de 
$R_s$. Asi obtenemos la siguiente figura:

\begin{figure}[H]
    \centering
    \includegraphics{polosyceros.png}
    \caption{Polos y ceros en funci√≥n de $R_s$}
\end{figure}

En esta figura se grafican los sucesivos valores que pueden tomar los polos y el cero si variamos el 
valor de $R_s$. Notamos una peque√±a disminuci√≥n de la parte imaginaria con el aumento de esta variable, 
aunque esto es casi despreciable. Tambi√©n se logra visualizar la distancia al eje imaginario que 
tiene cada posible valor y sobre todo el valor mas cercano a esta (representa el caso menos 
amortiguado).

De la misma podemos concluir que a medida que el valor de la temperatura aumenta, aumentando $R_s$, el 
sistema se vuelve mas estable. Esto se puede ver ya que al aumentar la parte real negativa, los 
mismos vuelven la respuesta del sistema mas amortiguados.

Para obtener el valor de la frecuencia natural del sistema y el amortiguamiento relativo, podemos 
comparar la ecuaci√≥n caracter√≠stica del sistema con la forma est√°ndar que toma un sistema de tercer 
orden. Pero al trabajar sobre el polinomio caracter√≠stico, teniendo en cuenta que un polo es 0, 
podemos simplificar y compararlo con uno de orden 2:

\begin{equation}
    s^2 + 2.\xi.\omega_n.s + \omega_n^2 = 0
\end{equation}

Igualando ambas expresiones obtenemos los siguiente valores:

\begin{align*}
    \omega_n = \sqrt{\frac{R_s.b_{eq} + \frac{3}{2}.P_p^2.{\lambda_m^{\prime r}}^2}{J_{eq}.L_q}} \\
    \xi = \frac{L_q.b_{eq} + R_s.J_{eq}}{2.J_{eq}.L_q.\omega_n}
\end{align*}

Reemplazando los valores de los par√°metros obtenemos que:

\begin{align*}
    314,50 rad/s < \omega_n < 314,72rad/s \\
    \xi < 1
\end{align*}

El valor de wn no varia significativamente con una variaci√≥n de $R_s$. El valor de $\xi$
se ve influenciado de mayor manera aunque siempre se mantiene en rangos menores a 1, lo que 
indica que es un sistema subamortiguado.

Podemos ver como var√≠an estos valores en los siguientes gr√°ficos:

\begin{figure}[H]
    \centering
    \includegraphics{frecuancia_amortiguamiento_rs.png}
    \caption{Frecuencia natural y amortiguamiento en funci√≥n de $R_s$}
\end{figure}

%-------------------- 5.1.4 --------------------------%

\subsection*{An√°lisis de Observabilidad}

Para realizar el an√°lisis de observabilidad completa de estados para el modelo LTI equivalente 
aumentado desde la salida $\theta_m$, evaluamos el rango de la matriz de observabilidad "$O$".

En este caso la matriz de observabilidad, teniendo en cuenta que es un sistema de 3er orden, 
debe tener orden 3 tambi√©n. Asi:

\begin{equation}
    O = \begin{bmatrix}
        C \\
        C.A \\
        C.A^2
    \end{bmatrix}
\end{equation}

Con:

\begin{equation}
    C = \begin{bmatrix}
        1 & 0 & 0
    \end{bmatrix}
\end{equation}

\begin{equation}
    C.A = 
    \begin{bmatrix}
        1 & 0 & 0
    \end{bmatrix}.
    \begin{bmatrix}
        0 & 1 & 0 \\
        0 & -\frac{b_{eq}}{J_{eq}} & \frac{3.P_p.\lambda_m^{\prime r}}{2.J_{eq}} \\
        0 & -\frac{P_p.\lambda_m^{\prime r}}{L_q} & -\frac{R_s}{L_q}
    \end{bmatrix}
    =
    \begin{bmatrix}
        0 & 1 & 0
    \end{bmatrix}
\end{equation}

\begin{equation}
    C.A^2 =
    \begin{bmatrix}
        1 & 0 & 0
    \end{bmatrix}.
    \begin{bmatrix}
        0 & 1 & 0 \\
        0 & -\frac{b_{eq}}{J_{eq}} & \frac{3.P_p.\lambda_m^{\prime r}}{2.J_{eq}} \\
        0 & -\frac{P_p.\lambda_m^{\prime r}}{L_q} & -\frac{R_s}{L_q}
    \end{bmatrix}.
    \begin{bmatrix}
        0 & 1 & 0 \\
        0 & -\frac{b_{eq}}{J_{eq}} & \frac{3.P_p.\lambda_m^{\prime r}}{2.J_{eq}} \\
        0 & -\frac{P_p.\lambda_m^{\prime r}}{L_q} & -\frac{R_s}{L_q}
    \end{bmatrix}
    =
    \begin{bmatrix}
        0 & -\frac{b_{eq}}{J_{eq}} & \frac{3.P_p.\lambda_m^{\prime r}}{2.J_{eq}}
    \end{bmatrix}
\end{equation}

Por lo tanto:

\begin{equation}
    O = 
    \begin{bmatrix}
        1 & 0 & 0 \\
        0 & 1 & 0 \\
        0 & -\frac{b_{eq}}{J_{eq}} & \frac{3.P_p.\lambda_m^{\prime r}}{2.J_{eq}}
    \end{bmatrix}
\end{equation}

El rango de esta matriz es 3, por lo tanto el sistema es completamente observable a partir de la 
salida $\theta_m$.

Estrictamente debemos decir que el sistema es parcialmente observable a partir de tener la posici√≥n 
como variable de salida ya que no se pueden obtener los estados de $i_ds^r$ ni $T_s^¬∞$.

Podemos realizar el mismo an√°lisis a partir de tener como variable medida la velocidad, utilizando 
un taco generador. En este caso tendremos:

\begin{equation}
    C = \begin{bmatrix}
        0 & 1 & 0
    \end{bmatrix}
\end{equation}

\begin{equation*}
    C.A = 
    \begin{bmatrix}
        0 & 1 & 0
    \end{bmatrix}.
    \begin{bmatrix}
        0 & 1 & 0 \\
        0 & -\frac{b_{eq}}{J_{eq}} & \frac{3.P_p.\lambda_m^{\prime r}}{2.J_{eq}} \\
        0 & -\frac{P_p.\lambda_m^{\prime r}}{L_q} & -\frac{R_s}{L_q}
    \end{bmatrix}
    =
    \begin{bmatrix}
        0 & -\frac{b_{eq}}{J_{eq}} & \frac{3.P_p.\lambda_m^{\prime r}}{2.J_{eq}}
    \end{bmatrix}
\end{equation*}

\begin{equation*}
    C.A^2 =
    \begin{bmatrix}
        0 & 1 & 0
    \end{bmatrix}.
    \begin{bmatrix}
        0 & 1 & 0 \\
        0 & -\frac{b_{eq}}{J_{eq}} & \frac{3.P_p.\lambda_m^{\prime r}}{2.J_{eq}} \\
        0 & -\frac{P_p.\lambda_m^{\prime r}}{L_q} & -\frac{R_s}{L_q}
    \end{bmatrix}.
    \begin{bmatrix}
        0 & 1 & 0 \\
        0 & -\frac{b_{eq}}{J_{eq}} & \frac{3.P_p.\lambda_m^{\prime r}}{2.J_{eq}} \\
        0 & -\frac{P_p.\lambda_m^{\prime r}}{L_q} & -\frac{R_s}{L_q}
    \end{bmatrix}
    =
    \begin{bmatrix}
        0 & -\frac{b_{eq}}{J_{eq}} - \frac{3.P_p^2.{\lambda_m^{\prime r}}^2}{2.J_{eq}.L_q} & \frac{3.b_{eq}.P_p.\lambda_m^{\prime r}}{2.J_{eq}^2}
    \end{bmatrix}
\end{equation*}

Entonces: 

\begin{equation*}
    O = 
    \begin{bmatrix}
        0 & 1 & 0 \\
        0 & -\frac{b_{eq}}{J_{eq}} & \frac{3.P_p.\lambda_m^{\prime r}}{2.J_{eq}} \\
        0 & -\frac{b_{eq}}{J_{eq}} - \frac{3.P_p^2.{\lambda_m^{\prime r}}^2}{2.J_{eq}.L_q} & \frac{3.b_{eq}.P_p.\lambda_m^{\prime r}}{2.J_{eq}^2}
    \end{bmatrix}
\end{equation*}

El rango de esta matriz es 2, por lo tanto podemos afirmar que el sistema no es observable a 
partir de la salida wùëö. Esto se debe a que conociendo la velocidad no se puede estimar la 
posici√≥n sin conocer la condici√≥n inicial de la misma.

%-------------------- 5.1.5 --------------------------%

\subsection*{An√°lisis de Controlabilidad}

Para afirmar si el sistema es controlable a partir de la entrada manipulada estipulada 
$v_{qs}^r(t)$ debemos estudiar el rango de la matriz de controlabilidad $C$. Esta nos 
proporcionara la certeza de si el sistema LTI se puede transferir desde cualquier estado inicial
a cualquier otro estado, mediante un vector de control no restringido en un intervalo de tiempo 
finito.

Para este caso la matriz de Controlabilidad es:

\begin{equation}
    C = 
    \begin{bmatrix}
        B & A.B & A^2.B
    \end{bmatrix}
\end{equation}

Con:

\begin{equation*}
    B = 
    \begin{bmatrix}
        0 \\
        0 \\
        \frac{1}{L_q}
    \end{bmatrix}
\end{equation*}

\begin{equation*}
    A.B = 
    \begin{bmatrix}
        0 & 1 & 0 \\
        0 & -\frac{b_{eq}}{J_{eq}} & \frac{3.P_p.\lambda_m^{\prime r}}{2.J_{eq}} \\
        0 & -\frac{P_p.\lambda_m^{\prime r}}{L_q} & -\frac{R_s}{L_q}
    \end{bmatrix}.
    \begin{bmatrix}
        0 \\
        0 \\
        \frac{1}{L_q}
    \end{bmatrix}
    =
    \begin{bmatrix}
        0 \\
        \frac{3.P_p.\lambda_m^{\prime r}}{2.J_{eq}} \\
        -\frac{R_s}{L_q}
    \end{bmatrix}
\end{equation*}

\begin{equation*}
    A^2.B =
    \begin{bmatrix}
        0 & 1 & 0 \\
        0 & -\frac{b_{eq}}{J_{eq}} & \frac{3.P_p.\lambda_m^{\prime r}}{2.J_{eq}} \\
        0 & -\frac{P_p.\lambda_m^{\prime r}}{L_q} & -\frac{R_s}{L_q}
    \end{bmatrix}.
    \begin{bmatrix}
        0 & 1 & 0 \\
        0 & -\frac{b_{eq}}{J_{eq}} & \frac{3.P_p.\lambda_m^{\prime r}}{2.J_{eq}} \\
        0 & -\frac{P_p.\lambda_m^{\prime r}}{L_q} & -\frac{R_s}{L_q}
    \end{bmatrix}.
    \begin{bmatrix}
        0 \\
        0 \\
        \frac{1}{L_q}
    \end{bmatrix}
    =
    \begin{matrix}
        \frac{3.P_p.\lambda_m^{\prime r}}{2.J_{eq}.L_q} \\
        -\frac{3.P_p.b_{eq}.\lambda_m^{\prime r}}{2.J_{eq}^2.L_q} - \frac{3.P_p.\lambda_m^{\prime r}.R_s}{2.J_{eq}.L_q^2} \\
        \frac{3.P_p.\lambda_m^{\prime r}}{2.J_{eq}^2}
    \end{matrix}
\end{equation*}

Entonces:

\begin{equation*}
    C = 
    \begin{bmatrix}
        0 & 0 & \frac{3.P_p.\lambda_m^{\prime r}}{2.J_{eq}.L_q} \\
        0 & \frac{3.P_p.\lambda_m^{\prime r}}{2.J_{eq}} & -\frac{3.P_p.b_{eq}.\lambda_m^{\prime r}}{2.J_{eq}^2.L_q} - \frac{3.P_p.\lambda_m^{\prime r}.R_s}{2.J_{eq}.L_q^2} \\
        \frac{1}{L_q} & -\frac{3.P_p.b_{eq}.\lambda_m^{\prime r}}{2.J_{eq}^2.L_q} - \frac{3.P_p.\lambda_m^{\prime r}.R_s}{2.J_{eq}.L_q^2} & \frac{3.P_p.\lambda_m^{\prime r}}{2.J_{eq}^2}
    \end{bmatrix}
\end{equation*}

En este caso el rango de la matriz de controlabilidad es 3, por lo tanto podemos afirmar que el 
sistema LTI equivalente simplificado es controlable desde la entrada indicada. Cabe aclarar que 
a partir de $v_{qs}^r(t)$ no es posible controlar la salida de los estados $i_ds^r$ ni $T_s^¬∞$ 
del sistema LTI equivalente aumentado. Estas podr√≠an controlares si se agrega entradas de control 
destinadas espec√≠ficamente para esto.

%-------------------- 5.1.6 --------------------------%

\subsection*{Simulaci√≥n Din√°mica}




%-------------------- 5.2 --------------------------%


\section*{Dise√±o, an√°lisis y simulaci√≥n con controlador de movimiento en cascada con modulador de torque equivalente (Control Vectorial)}

El control vectorial es una t√©cnica avanzada utilizada para controlar motores de corriente alterna y m√°quinas 
s√≠ncronas. Permite controlar de manera independiente la magnitud y la fase de la corriente de alimentaci√≥n de la 
m√°quina para lograr un control preciso del torque y la velocidad. Una implementaci√≥n com√∫n del control vectorial 
es el controlador de movimiento en cascada con modulador de torque equivalente, utilizado en aplicaciones de alto 
rendimiento como sistemas de tracci√≥n el√©ctrica y accionamiento de maquinaria industrial.

En el controlador de movimiento en cascada con modulador de torque equivalente, se utiliza un controlador de 
velocidad externo para generar una se√±al de referencia de velocidad que se compara con la velocidad real de la 
m√°quina. La diferencia entre estas se√±ales se utiliza para generar una se√±al de referencia de torque, que controla 
la corriente de alimentaci√≥n. El modulador de torque equivalente convierte la se√±al de referencia de torque en una
se√±al de corriente de alimentaci√≥n mediante la t√©cnica de modulaci√≥n de ancho de pulso (PWM), controlando as√≠ la 
magnitud y la fase de la corriente de alimentaci√≥n.

%-------------------- 5.2.1 --------------------------%

\subsection*{Modulador de torque equivalente (Controlador interno vectorial de corriente/torque)}

En el pr√≥ximo paso de nuestro sistema, se llevar√° a cabo la implementaci√≥n de un modulador de torque equivalente, 
conocido tambi√©n como controlador interno vectorial de corriente/torque. Este controlador nos permitir√°, de manera
similar a una m√°quina de corriente continua, controlar el sistema utilizando consignas de torque como entradas, 
las cuales ser√°n posteriormente transformadas en consignas de tensi√≥n. Para lograrlo, procederemos a implementar 
el controlador completo con su correspondiente diagrama de bloques, utilizando el modelo NL completo y los valores
de par√°metros adecuados, siguiendo los lineamientos que se detallar√°n a continuaci√≥n.

%-------------------- 5.2.1.a --------------------------%

\subsubsection*{Desacople de las realimentaciones de estado hacia la entrada}

Considerando que el modulador de tensi√≥n es lo suficientemente r√°pido y preciso, podemos asumir que su ganancia 
es unitaria. Por lo tanto, podemos considerar que en la entrada del modulador de tensi√≥n se tiene una consigna 
de tensi√≥n a seguir, y esta misma tensi√≥n se aplicar√° a la salida del modulador. 
En otras palabras, en la salida del modulador se obtiene la tensi√≥n como variable f√≠sica. Con base en lo 
mencionado, podemos establecer que:

\begin{equation}
    v_{abc}(t) \approx v^*_{abc}(t)
\end{equation}

Utilizando la transformada de Park, podemos definir una consigna de tensi√≥n en coordenadas virtuales 
$v^{r*}_{qd0s}(t)$ que nos permita obtener una tensi√≥n $v^{r}_{qd0s}(t)$ que compense los efectos de 
retroalimentaci√≥n y permita el desacople de las variables de estado.

Recordando las \hyperref[eq:mi_ecuacion]{Ecuaciones \ref*{eq:mi_ecuacion}}, se observa que los t√©rminos 
del lado derecho de la igualdad, a excepci√≥n de las tensiones de fase virtuales, representan las 
realimentaciones f√≠sicas del sistema. Por lo tanto, podemos definir las compensaciones que deben 
realizarse en el controlador para cancelar los efectos de la retroalimentaci√≥n, las cuales son:

\begin{equation}\label{eq:compensaciones}
    \begin{cases}
        v^r_{qs}(t) = v^{r*}_{qs}(t) + R_{s}.i_{qs}^r(t) + \omega_m(t).P_p.[\lambda^{\prime r}_m + L_d.i_{qs}^r(t)] \\
        v^r_{ds}(t) = v^{r*}_{ds}(t) + R_{s}.i_{ds}^r(t) - \omega_m(t).P_p.L_q.i_{qs}^r(t) \\
        v^r_{0s}(t) = v^{r*}_{0s}(t) + R_{s}.i_{0s}^r(t) \\
    \end{cases}
\end{equation}

Realizando estas compensaciones, tenemos acceso directo a manipular el torque electromagn√©tico, 
sin los efectos de las realimentaciones f√≠sicas, ni las ca√≠das de tensi√≥n en los bobinados.

Reemplazando las \hyperref[eq:compensaciones]{Ecuaciones \ref*{eq:compensaciones}} en las
\hyperref[eq:mi_ecuacion]{Ecuaciones \ref*{eq:mi_ecuacion}}, se obtienen las siguientes expresiones:

\begin{equation}\label{eq:proporcionlaidad_corrientes_tensiones_de_entrada}
    \begin{cases}
        v^{r*}_{qs}(t) = L_q. \dot{i}_{qs}^r(t) \\
        v^{r*}_{ds}(t) = L_d. \dot{i}_{ds}^r(t) \\
        v^{r*}_{0s}(t) = L_{ls}. \dot{i}_{0s}^r(t) \\
    \end{cases}
\end{equation}

% Aca muestra una imagen del modelo el modelo pag. 35 %

% En la siguiente p√°gina se muestra el modelo de bloques que considera el desacople de las 
% realimentaciones f√≠sicas, teniendo en cuenta la variaci√≥n de la temperatura del sistema $(Ts(t))$. 
% En este modelo, se tiene en cuenta que la resistencia de los devanados del estator var√≠a con la 
% temperatura. Se ha decidido mantener esta variaci√≥n en la resistencia, ya que fue considerada en 
% el modelo no lineal con la ley de control m√≠nima. Aunque se reconoce que la variaci√≥n de la 
% resistencia con la temperatura es peque√±a, mantener esta variaci√≥n permite lograr acciones de control 
% m√°s efectivas, replicando de manera m√°s precisa el comportamiento real del sistema f√≠sico. Adem√°s, 
% el costo computacional de esta medida es m√≠nimo.

%-------------------- 5.2.1.b --------------------------%

\subsubsection*{Dise√±o de lazos de control de corrientes}

La consigna de tensi√≥n es funci√≥n de la corriente del sistema, por lo que se puede controlar usando 
una consigna de corriente proporcional. Con el error de corriente entre la corriente de consigna 
$i_{qd0s}^{r*}(t)$y la corriente real del sistema se modela $v_{qd0s}^{r*}(t)$ con una ley de 
control proporcional.. El modelo resultante es el siguiente:

\begin{equation}
    \begin{cases}
        L_q. \dot{i}_{qs}^r(t) = v^{r*}_{qs}(t) = [i_{qs}^{r*}(t) - i_{qs}^r(t)].R_q^\prime \\
        L_d. \dot{i}_{ds}^r(t) = v^{r*}_{ds}(t) = [i_{ds}^{r*}(t) - i_{ds}^r(t)].R_d^\prime \\
        L_{ls}. \dot{i}_{0s}^r(t) = v^{r*}_{0s}(t) = [i_{0s}^{r*}(t) - i_{0s}^r(t)].R_{0}^\prime \\
    \end{cases}
\end{equation}

Las variables $R^\prime$ representan las ganancias del control proporcional. Se necesita obtener 
el valor de √≥ptimo de esta ganancia, por lo cual se analiza la funci√≥n de transferencia del modulador.

Al aplicar la transformada de Laplace obtenemos:

\begin{equation}
    \begin{cases}
        L_q. s.I_{qs}^r(s) = [I_{qs}^{r*}(s) - I_{qs}^r(s)].R_q^\prime \\
        L_d. s.I_{ds}^r(s) = [I_{ds}^{r*}(s) - I_{ds}^r(s)].R_d^\prime \\
        L_{ls}. s.I_{0s}^r(s) = [I_{0s}^{r*}(s) - I_{0s}^r(s)].R_{0}^\prime \\
    \end{cases}
\end{equation}

Las funciones de transferencia son:

\begin{align*}
    G_{qs}(s) &= \frac{I_{qs}^r(s)}{I_{qs}^{r*}(s)} = \frac{1}{\frac{L_q}{R_q^\prime}.s + 1}  \\
    G_{ds}(s) &= \frac{I_{ds}^r(s)}{I_{ds}^{r*}(s)} = \frac{1}{\frac{L_d}{R_d^\prime}.s + 1}  \\
    G_{0s}(s) &= \frac{I_{0s}^r(s)}{I_{0s}^{r*}(s)} = \frac{1}{\frac{L_{ls}}{R_{0}^\prime}.s + 1}
\end{align*}

Se puede observar que las funciones de transferencia son de primer orden y no poseen ceros. Dado que
los par√°metros son positivos tambi√©n podemos afirmar que las funciones de transferencia son estables.

Estas funciones de transferencia tienen la forma t√≠pica de un filtro pasa bajos, donde el valor que
multiplica a la variable $s$ es la constante del tiempo del sistema \tau que a la vez es el inverso
la frecuencia de corte del filtro. Si \tau toma un valor muy peque√±o, dispondremos de una ancho de 
banda muy grande, lo cual proporciona una respuesta r√°pida.

El polo del filtro pasa bajos es $p = -\frac{1}{\tau}$ y dado que para todos los lazos $p = -5000 rad/s$
podemos calcular los valores de las ganancias:

\begin{equation}
    \frac{L}{R^\prime} = -\frac{1}{p} \to R^\prime = -L.p
\end{equation}

Resolviendo para cada rama:

\begin{align*}
    R_q^\prime &= -L_q.p = 29\varOmega  \\
    R_d^\prime &= -L_d.p = 33\varOmega \\
    R_0^\prime &= -L_{ls}.p = 4\varOmega
\end{align*}

Con este lazo de corriente logramos que el error entre la consigna de corriente y la corriente real
converja mas r√°pidamente a cero, de forma que responda de mejor manera a las perturbaciones.

% Im√°genes %

% Estar√≠a bueno responder la diferencia entre la consigna 5.1.2.c.vi %

%-------------------- 5.2.1.c --------------------------%

\subsubsection*{Incorporaci√≥n de consigna de torque}

Volvemos a usar nuevamente el m√©todo de la secci√≥n anterior en el que realizamos una realimentaci√≥n
para controlar el sistema mediante consignas de torque $T_m^*(t)$. La consigna sigue el siguiente modelo:

\begin{equation}
    T_m^*(t) = T_m^{r\prime}(t) + b_{eq}.\omega_m(t)
\end{equation}

Este modelo contempla la realimentaci√≥n f√≠sica debida a la fricci√≥n, que genera perdidas en el torque.

Sabiendo que el torque y la corriente est√°n relacionados por la ecuaci√≥n del
\hyperref[eq.torque_electromagnetico]{Torque electromagn√©tico (\ref*{eq.torque_electromagnetico})}
expresamos las consignas de troque $T_m^{*\prime}$ en funci√≥n de las consignas de corriente $i_{qs}^{r*}$:

\begin{equation}
    T_m^{*}(t) = \frac{3}{2}.P_p.[\lambda_m^{\prime r} + (L_d - L_q)i_{ds}^{r}(t)].i_{qs}^{r*}(t)
\end{equation}

Despejando de estas ultimas dos ecuaciones, obtenemos:

\begin{equation}
    i_{qs}^{r*}(t) = \frac{T_m^{*\prime}(t) + b_{eq}.\omega_m(t)}{\frac{2}{3}.P_p.[\lambda_m^{\prime r} + (L_d - L_q)i_{ds}^{r}(t)]}
\end{equation}

% IMAGEN DEL MODULADOR DE TORQUE %

% DUDAS YA QUE NO TRABAJAMOS CON IDS %

De esta ecuaci√≥n podemos determinar el efecto que tendr√° la corriente $i_{ds}^{r*}$ sobre el flujo magn√©tico:

\begin{itemize}
    \item Si $i_{ds}^{r*} > 0 A$ entonces se produce un reforzamiento de campo.
    \item Si $i_{ds}^{r*} = 0 A$ entonces se produce un desacople entre la rama correspondiente a 
    la cuadratura que anula los efectos de reforzamiento y debilitamiento.
    \item Si $i_{ds}^{r*} < 0 A$ entonces se produce un debilitamiento de campo.
\end{itemize}

%-------------------- 5.2.2 --------------------------%

\subsection*{Controlador externo de movimiento (posici√≥n/velocidad)}

El controlador externo de movimiento se agrega con el fin de mejorar la din√°mica del sistema y corregir los
errores de estado estacionario producidos por cargas perturbadoras. En la rama derivativa tomaremos el 
error entre la consigna de velocidad y la velocidad real. El error de posici√≥n se obtiene integrando el 
error de velocidad lo que indica que no son variables independientes, este va en la rama proporcional.
En la rama integral se tendr√° la integral del erro de posici√≥n. 

% Filtro pasa alto %
Con esta configuraci√≥n del controlador PID solo tendremos como entrada el error de velocidades, no tendremos
que introducir acciones derivativas lo que nos permitir√° evitar la amplificaci√≥n del ruido y obtener un 
controlador mas estable. Los bloques integrales act√∫an como filtros pasa bajos lo que nos ayuda a eliminar
el ruido de los errores de posici√≥n y velocidad dada su naturaleza de alta frecuencia.

Se dise√±a el controlador utilizando el m√©todo de sinton√≠a serie con $n = 2,5$, $\omega_{pos} = 800 rad/s$, y
considerando los valores nominales de $j_l$, $b_l$. 

El controlador de movimiento se muestra en la siguiente figura: 

% IMAGEN DEL PID %

La salida del controlador sera el torque consigna que ingresara al modulador de torque. Modelando en el 
dominio de Laplace se tiene:

\begin{equation}\label{eq.controlador_error}
    T_m^{*\prime}(s) = e_\omega(s).b_a + e_\theta(s).K_{sa} + e_\theta(s).K_{sai}.\frac{1}{s}
\end{equation}

Donde:

\begin{align*}
    e_\theta(s) &= \Theta_m^*(s) - \Theta_m(s) \\
    e_\omega(s) &= e_\theta(s).s
\end{align*}

La relaci√≥n entre el torque y la variaci√≥n de velocidad del motor en el modelo del subsistema mec√°nico, 
teniendo en cuanta el desacople de fricci√≥n realizado anteriormente, es:

\begin{equation}
    J_{eq}.\dot{\omega}_(t) = T_m^*(t) - \frac{T_l(t)}{r}
\end{equation}

Aplicando la transformada de Laplace:

\begin{equation}
    J_{eq}.s^2.\Theta_m(s) = T_m^*(s) - \frac{T_l(s)}{r}
\end{equation}

Reemplazando esta ecuaci√≥n en la
\hyperref[eq.controlador_error]{ecuaci√≥n del controlador (\ref*{eq.controlador_error})}:

\begin{equation}
    J_{eq}.s^3.\Theta_m(s) = [s^2.b_a + s.K_{sa} + K_{sai}].[\Theta_m^*(s) - \Theta_m(s)] - s.\frac{T_l(s)}{r}
\end{equation}

Despejando, la posici√≥n del retor queda expresada como:

\begin{equation}
    \Theta_m(s) = \frac{s^2.b_a + s.K_{sa} + K_{sai}}{s^3.J_{eq} + s^2.b_a + s.K_{sa} + K_{sai}}.\Theta_m^*(s) - \frac{s}{s^3.J_{eq} + s^2.b_a + s.K_{sa} + K_{sai}}.\frac{T_l(s)}{r}
\end{equation}

A partir de esta ecuaci√≥n podemos obtener las funciones de transferencia del controlador:

\begin{align}
    G_1(s) &= \frac{\Theta_m(s)}{\Theta_m^*(s)} = \frac{s^2.b_a + s.K_{sa} + K_{sai}}{s^3.J_{eq} + s^2.b_a + s.K_{sa} + K_{sai}} \\
    G_2(s) &= \frac{\Theta_m(s)}{\frac{T_l(s)}{r}} = -\frac{s}{s^3.J_{eq} + s^2.b_a + s.K_{sa} + K_{sai}}
\end{align}

En r√©gimen estacionario para una entrada escal√≥n unitario podemos observar:

\begin{itemize}
    \item $K_{sai} \neq 0 \to G_1(s) = 1 $ y $G_2(s) = 0$
    \item $K_{sai} = 0 \to G_2(s) = 1 $ y $G_2(s) = \frac{1}{K_{sa}} $
\end{itemize}

Estos resultados muestran que que la funci√≥n de transferencia
correspondiente a la entrada de perturbaci√≥n tejen un cero en el origen por lo que el error de estado 
estacionario es nulo. En caso de que la acci√≥n integral sea nula si tendr√° un error dado por $1/K_{sa}$.
En cuanto a la funci√≥n de transferencia correspondiente a la entrada de referencia tiene ganancia
unitaria a baja frecuencia por lo que el error de estado estacionario, seg√∫n el teorema del valor final, 
es nulo. Podemos concluir que este  controlador no tiene error de r√©gimen permanente ante entradas del tipo escal√≥n.

Aplicamos el m√©todo de sinton√≠a en serie, con $n = 2,5$ y $\omega_{pos} = 800 rad/s$
para la determinar las ganancias del controlador. Dado que el polinomio 
caracter√≠stico de forma normalizada del sistema es:

\begin{equation}
    P(s) = s^3 + \frac{b_a}{J_{eq}}.s^2 + \frac{K_{sa}}{J_{eq}}.s + \frac{K_{sai}}{J_{eq}}
\end{equation}

Podemos llegar a las siguientes expresiones:

\begin{align*}
    n.\omega_{pos} &= \frac{b_a}{J_{eq}}; & &n.\omega_{pos}^2 = \frac{K_{sa}}{J_{eq}}; & n.\omega_{pos}^3 = \frac{K_{sai}}{J_{eq}} \\
\end{align*}

Dados los valores nominales de $J_{eq}$ y $b_l$, se obtiene $J_{eq} = 5,6510.10^6$, entonces:

\begin{align*}
    b_a = J_{eq}.n.\omega_{pos} &= 0,0113\, \frac{N.m}{rad/s} \\ 
    K_{sa} = J_{eq}.n.\omega_{pos}^2 &= 9,0416\, \frac{N.m}{rad} \\
    K_{sai} = J_{eq}.n.\omega_{pos}^3 &= 2893\, \frac{N.m}{rad.s}
\end{align*}

Con estos valores podemos determinar los polos del sistema a lazo cerrado. Sabiendo que la distancia
de los polos al origen es la misma para los 3 polos. Con $\xi = 0,75$

\begin{itemize}
    \item Para valores nominales de $J_l$ y $b_l$:
    
    \begin{align*}
        s_1 = -800\, \frac{rad}{s} & & s_2,3  = -600 \pm 529,15\, j \, \frac{rad}{s} 
    \end{align*}
    
    \item Para valores m√°ximos de $J_l$ y $b_l$:
    
    \begin{align*}
        s_1 = -613,75\, \frac{rad}{s} & & s_2,3  = -508,98 \pm 649,26\, j \, \frac{rad}{s} 
    \end{align*}

    \item Para valores m√≠nimos de $J_l$ y $b_l$:
    
    \begin{align*}
        s_1 = -1498,5\, \frac{rad}{s} & & s_2,3  = -542,3 \pm 383,7\, j \, \frac{rad}{s} 
    \end{align*}

\end{itemize}

% MOSTRAR LA IMAGEN DE LOS POLOS %

%-------------------- 5.2.2 --------------------------%

\subsubsection*{Entrada de referencia o set-point}

Por √∫ltimo, se incluye la opci√≥n de ingresar el control de posici√≥n mediante una referencia o punto de 
ajuste de posici√≥n de las coordenadas articulares del brazo del robot SCARA. Esto resulta conveniente, ya que 
en muchas ocasiones es m√°s sencillo utilizar los algoritmos de Cinem√°tica del robot para controlar 
el brazo, utilizando sus coordenadas articulares. De forma que:

\begin{equation}
    q_1^* = \frac{\theta_m^*(t)}{r}
\end{equation}

% IMAGEN DEL SET-POINT %

%-------------------- 5.2.3 --------------------------%

\subsection*{Observador de Estado de orden reducido}

Un observador de estado es un componente utilizado en sistemas de control para estimar el estado interno 
de un sistema din√°mico a partir de las mediciones de entradas y salidas del sistema. En este caso, se
utiliza un observador de estado de orden reducido para poder realimentar la velocidad angular del motor 
ya que este no cuenta con un sensor para medirla directamente.

El sistema no es observable desde la velocidad $\omega_m(t)$ como lo indica el criterio de observabilidad 
de Kalman, pero si desde la posici√≥n $\theta_m(t)$. Por lo tanto estimaremos la velocidad a partir de la 
posici√≥n.

Al incorporar el observador al subsistema mec√°nico podemos omitir $-b_{eq}.\omega_{m}(t)$ ya que al 
contar con sensores de corriente con realimentaci√≥n f√≠sica este efecto ya est√° desacoplado.  

El modelo del subsistema mec√°nico se puede expresar como:

\begin{equation}
    \begin{cases}
        \dot{x}(t) = A.x(t) + B_c.u(t) +B_d.d(t)  \, ; \,\, x(t_0) = x_0\\
        y(t) = C.x(t) \\
    \end{cases}
\end{equation}

\begin{equation}
    \begin{cases}
        \dot{x}(t) = 
        \begin{bmatrix}
            0 & 1 \\
            0 & 0 \\
        \end{bmatrix}
        .x(t) + 
        \begin{bmatrix}
            0 \\
            \frac{1}{J_{eq}} \\
        \end{bmatrix}
        .T_m(t) +
        \begin{bmatrix}
            0 \\
            -\frac{1}{J_{eq}.r} \\
        \end{bmatrix}
        .T_l(t)\\
        y(t) = 
        \begin{bmatrix}
            1 & 0 \\
        \end{bmatrix}
        .x(t) \\
    \end{cases}
\end{equation}

El observador de estado de Luenberger crea un modelo estimado del sistema original que reproduce su 
comportamiento a partir de las variables de entrada y salida medibles. Luego, utiliza este modelo estimado 
junto con una correcci√≥n proporcional al error de salida para estimar el estado interno del sistema en 
tiempo real. Aplic√°ndolo al sistema anterior, se obtiene:

\begin{equation}
    \begin{cases}
        \dot{\hat{x}}(t) = \hat{A}.\hat{x}(t) + \hat{B}.u(t) + K_e.(y(t) - \hat{y}(t)) \, ; \,\, \hat{x}(t_0) = 0\\
        \hat{y}(t) = \hat{C}.\hat{x}(t) \\
    \end{cases}
\end{equation}

Donde la matriz $K_e$ contiene los par√°metros de ajuste del observador

\begin{equation}
    K_e = 
    \begin{bmatrix}
        k_{e\theta} & k_{e\omega} \\
    \end{bmatrix}
\end{equation}

Con el error de estimaci√≥n definido como:

\begin{equation}\label{eq.error_estimacion}
    e(t) = x(t) - \hat{x}(t)
\end{equation}

Asumiendo un funcionamiento ideal, las matrices de ambos sistemas real coinciden con las matrices del
modelo del observador. Trabajando el sistema y reemplazando en la   
\hyperref[eq.error_estimacion]{ecuaci√≥n (\ref*{eq.error_estimacion})}
se obtiene la din√°mica del error:

\begin{equation}
    \dot{e}(t) = [A - K_e.C].e(t) + B.d(t)
\end{equation}

Considerando que no hay perturbaciones $d(t) = 0$, se pueden obtener los par√°metros de ajuste del observador
mediante el polinomio caracter√≠stico del sistema dado por los autovalores de la matriz 
$A^\prime = [A - K_e.C]$:

\begin{equation}
    \mid s.I - A^\prime\mid \,\,= 
    \begin{bmatrix}
        s + k_{e\theta} & -1 \\
        k_{e\omega} & s 
    \end{bmatrix}
    = s^2 + k_{e\theta}.s + k_{e\omega}
\end{equation}

Resolviendo el polinomio y sabiendo que los polos son $p_{1,2} = -3200\, rad/s$, obtengo:

\begin{align*}
    K_{e\theta} = 6400\,rad/s \\
    K_{e\omega} = 10,24.10^6\,rad/s
\end{align*}

% IMAGEN DEL OBSERVADOR %

%-------------------- 5.2.4 --------------------------%

%-------------------- 5.2.5 --------------------------%

%-------------------- 5.2.6 --------------------------%


\newpage
\part*{Conclusiones}

\newpage
\part*{Referencias}
\lipsum{}
\label{LastPage}    
\end{document}